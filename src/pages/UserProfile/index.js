import React, { useState, useEffect, useLayoutEffect } from "react";
import * as yup from "yup";
import { useFormik } from "formik";
import { Link as LinkRouter } from "react-router-dom";
import { useMemo } from "react";
import { useNavigate, redirect } from "react-router-dom";
import useMediaQuery from "@mui/material/useMediaQuery";

import BasicTabs from "./tasPanel";
import BasicModal from "./passwordModal";

//IMPORT MUI
import { styled } from "@mui/material/styles";
import Box from "@mui/material/Box";
import Paper from "@mui/material/Paper";
import Grid from "@mui/material/Grid";
import Button from "@mui/material/Button";
import Stack from "@mui/material/Stack";
import { Typography } from "@mui/material";
import PersonIcon from "@mui/icons-material/Person";
import LogoutIcon from "@mui/icons-material/Logout";
import TextField from "@mui/material/TextField";
import Radio from "@mui/material/Radio";
import RadioGroup from "@mui/material/RadioGroup";
import FormControlLabel from "@mui/material/FormControlLabel";
import Link from "@mui/material/Link";
import CheckCircleIcon from "@mui/icons-material/CheckCircle";
import FormHelperText from "@mui/material/FormHelperText";
import { useTheme } from "@mui/material/styles";
import { Alert, AlertTitle, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, Divider } from "@mui/material";

export default function UserProfile() {
  const navigate = useNavigate();
  const theme = useTheme();
  const isXsScreen = useMediaQuery(theme.breakpoints.only("xs"));
  const isMdScreen = useMediaQuery(theme.breakpoints.only("md"));
  const [password, setPassword] = useState();
  const [flag, setFlag] = useState(false);
  const [isFinish, setIsFinish] = useState(false);
  const [account, setAccount] = useState({
    email: localStorage.getItem("email"),
    name: localStorage.getItem("name"),
    images: localStorage.getItem("images"),
    memberShip: localStorage.getItem("memberShip"),
    gender: localStorage.getItem("gender"),
    phone: localStorage.getItem("phone"),
  });

  useEffect(() => {
    if (!localStorage.getItem("email")) {
      navigate("/login");
    }
  }, [])

  useMemo(() => {
    if (
      localStorage.getItem("email") != null &&
      localStorage.getItem("id") == null
    ) {
      const getAccountID = () => {
        fetch(
          "https://64acf61eb470006a5ec514b7.mockapi.io/movie/account?email=" +
          account.email,
          {
            method: "GET",
            headers: { "content-type": "application/json" },
          }
        )
          .then((res) => {
            if (res.ok) {
              console.log("Successfully get account id");
              return res.json();
            } else {
              console.log("Fail get account id");
            }
          })
          .then((tasks) => {
            localStorage.setItem("id", tasks[0].id);
          })
          .catch((error) => {
            console.log("Fail get account id: ", error);
          });
      };
      getAccountID();
    }
  }, []);

  //XỬ LÝ LẤY THÔNG TIN PASSWORD
  useEffect(() => {
    const getAccountID = async () => {
      try {
        const response = await fetch(
          "https://64acf61eb470006a5ec514b7.mockapi.io/movie/account?email=" +
          localStorage.getItem("email"),
          {
            method: "GET",
            headers: { "content-type": "application/json" },
          }
        );

        if (response.ok) {
          console.log("Successfully lấy thông tin password");
          const tasks = await response.json();
          setPassword(tasks[0].password);
        } else {
          console.log("Fail lấy thông tin password");
        }
      } catch (error) {
        console.log("Fail lấy thông tin password: ", error);
      }
    };
    getAccountID();
  }, [password, flag]);

  const [updateAccount, setUpdateAccount] = useState(false);
  //Chỉnh sửa tài khoản
  const handleChangeAccount = () => {
    formik.resetForm({ values: { ...formik.initialValues } });
    setUpdateAccount(!updateAccount);
  };

  //XỬ LÝ SUBMIT VALIDATE CHỈNH SỬA THÔNG TIN
  const validationSchema = yup.object({
    fullName: yup.string().required("Name is required"),
    phone: yup
      .string()
      .nullable()
      .matches(/^\d{10}$/, "Phone number is not valid"),
  });

  const formik = useFormik({
    initialValues: {
      fullName: account.name,
      email: account.email,
      phone: account.phone == "null" ? "" : account.phone,
      gender: account.gender == "null" ? "" : account.gender,
    },
    validationSchema,
    onSubmit: (values, { resetForm }) => {
      handleUpdateProfile(values);
      resetForm({
        values: {
          fullName: values.fullName,
          email: values.email,
          phone: values.phone,
          gender: values.gender,
        },
      });
      localStorage.setItem("name", values.fullName);
      localStorage.setItem("phone", values.phone);
      localStorage.setItem("gender", values.gender);
      setUpdateAccount(!updateAccount);
    },
  });

  const handleUpdateProfile = (values) => {
    fetch(
      `https://64acf61eb470006a5ec514b7.mockapi.io/movie/account/` +
      localStorage.getItem("id"),
      {
        method: "PUT", // or PATCH
        headers: { "content-type": "application/json" },
        body: JSON.stringify(values),
      }
    )
      .then((res) => {
        if (res.ok) {
          console.log("Successfully update profile");
          setIsFinish(true);
          return res.json();
        } else {
          console.log("Fail update profile");
        }
      })
      .catch((error) => {
        console.log("Fail update profile: ", error);
      });
  };

  //XỬ LÝ THAY ĐỔI GENDER
  const handleChangeGender = (e) => {
    const gender = document.getElementById("gender");
    gender.value = e.target.value;
    formik.setFieldValue("gender", e.target.value);
  };

  //XỬ LÝ ĐĂNG XUẤT
  const handleLogout = () => {
    localStorage.removeItem("accessToken");
    localStorage.removeItem("name");
    localStorage.removeItem("email");
    localStorage.removeItem("images");
    localStorage.removeItem("gender");
    localStorage.removeItem("memberShip");
    localStorage.removeItem("phone");
    localStorage.removeItem("id");
    navigate("/login");
    window.location.reload();
  };

  //XỬ LÝ POPUP THÔNG BÁO
  const handleCloseFinish = () => {
    setIsFinish(false);
  };


  return (
    <Box sx={{ flexGrow: 1, marginTop: 9, width: "100%", height: 600 }}>
      <Grid
        container
        sx={{
          paddingX: { xs: 0, md: 25 },
          bgcolor: "white",
          height: "100%",
          width: "100%",
        }}
      >
        <Grid item xs={12} md={3}>
          <Grid
            container
            direction={"column"}
            sx={{
              overflowY: "hidden",
              height: "100%",
              bgcolor: "rgb(245, 245, 245)",
            }}
          >
            <Grid item xs={12} md={5} sx={{ overflowY: "hidden", padding: 0 }}>
              <StyledPaper>
                <Stack>
                  <Item sx={{ paddingTop: 2 }}>
                    {localStorage.getItem("memberShip") == "true" && (
                      <svg
                        height="5rem"
                        width="5rem"
                        class="icon-cup"
                        viewBox="0 0 125 92"
                        version="1.1"
                        xmlns="http://www.w3.org/2000/svg"
                        link="http://www.w3.org/1999/xlink"
                      >
                        <g
                          id="Detail"
                          stroke="none"
                          stroke-width="1"
                          fill="beige"
                          fill-rule="evenodd"
                        >
                          <g
                            id="SVOD-Detail-option-1---not-sign-up--choose-packed-add-new-Credit---date-expired"
                            transform="translate(-91.000000, -324.000000)"
                            fill-rule="nonzero"
                          >
                            <g id="screen/detail/credit-card">
                              <g
                                id="product/detail"
                                transform="translate(42.000000, 264.000000)"
                              >
                                <g id="packed/month/detail">
                                  <g id="packed/month-new-copy-4">
                                    <g id="Group">
                                      <g
                                        id="Group-3"
                                        transform="translate(0.000000, 44.000000)"
                                      >
                                        <g
                                          id="icon/packed/monthly-copy"
                                          transform="translate(49.000000, 0.000000)"
                                        >
                                          <g
                                            id="winner"
                                            transform="translate(0.000000, 16.533333)"
                                          >
                                            <g
                                              id="Group"
                                              transform="translate(0.000000, 8.266667)"
                                              fill="#FF901D"
                                            >
                                              <path
                                                d="M8.97998026,9.1389976 C11.9467772,5.90094126 15.055664,2.98722787 18.4787597,0.282090442 C18.8813476,-0.0359024196 19.4609375,0.344858618 19.3261718,0.839921237 C17.4074706,7.89462461 14.0551757,14.8665326 8.88745096,20.0494255 C8.65527322,16.421083 8.65185525,12.7624554 8.97998026,9.1389976 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M8.88769536,20.0521122 C5.90405276,16.4501469 3.34008791,12.7260646 1.0300293,8.70548203 C0.765869144,8.24583335 0.0632324222,8.40971447 0.0363769533,8.93945834 C-0.380371096,17.1752781 2.76513673,26.8117808 10.428711,30.6985231 C9.66503911,27.1962054 9.11474614,23.6320964 8.88769536,20.0521122 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M10.4282227,30.6958365 C12.3059083,26.8308311 14.407715,23.2349717 16.8713382,19.7495061 C17.1635745,19.3360177 17.8190921,19.5255434 17.8403324,20.0315966 C18.1403812,27.1458931 16.9201663,34.6663511 13.5126955,40.9114183 C12.2495118,37.5873915 11.1840821,34.1729981 10.4282227,30.6958365 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M13.5134279,40.9138626 C9.63916026,38.4229184 6.10009774,35.6994633 2.70532232,32.6401862 C2.31372076,32.2872678 1.69946294,32.6558172 1.8320313,33.1660223 C3.87719733,41.0325604 9.72583018,49.1052321 18.0524904,50.5310711 C16.3215333,47.4390667 14.7709962,44.2295856 13.5134279,40.9138626 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M18.0510256,50.528871 C18.7297366,46.3124126 19.7004397,42.2901204 21.0517581,38.2688052 C21.2124027,37.7905947 21.8913578,37.7813138 22.0598148,38.2570819 C24.4230961,44.9315128 25.3803715,52.4614958 23.9545902,59.3816262 C21.7871097,56.5753758 19.7819827,53.6262485 18.0510256,50.528871 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M23.9560544,59.3838246 C19.5397947,58.1321246 15.3674315,56.5668279 11.2353515,54.6481245 C10.7580565,54.4263599 10.2795409,54.9578134 10.5546874,55.4064715 C14.8032225,62.3375924 22.757324,68.3384254 31.1350094,67.304338 C28.5632321,64.839527 26.1330563,62.2064387 23.9560544,59.3838246 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M31.1330564,67.3026267 C30.5305174,63.0544179 30.2744139,58.9109855 30.3928221,54.6517862 C30.4067381,54.1469542 31.054199,53.9400879 31.3540037,54.3464935 C35.585449,60.0855076 38.7421872,67.0569271 39.4975583,74.1248192 C36.5551755,72.0561559 33.7299802,69.7950362 31.1330564,67.3026267 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M116.020015,9.1389976 C113.053218,5.90094126 109.944331,2.98722787 106.521236,0.282090442 C106.118648,-0.0359024196 105.539058,0.344858618 105.673824,0.839921237 C107.592525,7.89462461 110.94482,14.8665326 116.112544,20.0494255 C116.344722,16.421083 116.34814,12.7624554 116.020015,9.1389976 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M116.112301,20.0521122 C119.095943,16.4501469 121.659908,12.7260646 123.969967,8.70548203 C124.234127,8.24583335 124.936764,8.40971447 124.963619,8.93945834 C125.380367,17.1752781 122.23486,26.8117808 114.571285,30.6985231 C115.334957,27.1962054 115.88525,23.6320964 116.112301,20.0521122 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M114.571776,30.6958365 C112.69409,26.8308311 110.592284,23.2349717 108.12866,19.7495061 C107.836424,19.3360177 107.180907,19.5255434 107.159666,20.0315966 C106.859617,27.1458931 108.079832,34.6663511 111.487303,40.9114183 C112.750487,37.5873915 113.815917,34.1729981 114.571776,30.6958365 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M111.486569,40.9138626 C115.360837,38.4229184 118.899899,35.6994633 122.294675,32.6401862 C122.686276,32.2872678 123.300534,32.6558172 123.167966,33.1660223 C121.1228,41.0325604 115.274167,49.1052321 106.947507,50.5310711 C108.678464,47.4390667 110.229001,44.2295856 111.486569,40.9138626 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M106.948978,50.528871 C106.270267,46.3124126 105.299564,42.2901204 103.948246,38.2688052 C103.787601,37.7905947 103.108646,37.7813138 102.940189,38.2570819 C100.576908,44.9315128 99.6196324,52.4614958 101.045414,59.3816262 C103.212894,56.5753758 105.218021,53.6262485 106.948978,50.528871 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M101.043947,59.3838246 C105.460207,58.1321246 109.63257,56.5668279 113.76465,54.6481245 C114.241945,54.4263599 114.72046,54.9578134 114.445314,55.4064715 C110.196779,62.3375924 102.242677,68.3384254 93.8649919,67.304338 C96.4367692,64.839527 98.866945,62.2064387 101.043947,59.3838246 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M93.8669409,67.3026267 C94.46948,63.0544179 94.7255835,58.9109855 94.6071753,54.6517862 C94.5932593,54.1469542 93.9457983,53.9400879 93.6459936,54.3464935 C89.4145484,60.0855076 86.2578102,67.0569271 85.5024391,74.1248192 C88.4448218,72.0561559 91.2700171,69.7950362 93.8669409,67.3026267 Z"
                                                id="Path"
                                              ></path>
                                            </g>
                                            <g
                                              id="Group"
                                              transform="translate(8.333333, 0.000000)"
                                              fill="#F7BC14"
                                            >
                                              <path
                                                d="M42.8890708,87.0858092 C39.5162109,85.40285 36.43317,83.5717785 33.725189,81.6441013 C33.7244584,81.6436085 33.7239713,81.643362 33.7232407,81.6428691 C33.7227536,81.6426227 33.72251,81.6421298 33.7220229,81.6418834 C30.6998684,79.4929004 27.9750828,77.2455867 25.6224345,74.9617994 C25.6219474,74.9613065 25.6214603,74.9605672 25.6209732,74.9600743 C22.9802107,72.4005173 20.6402268,69.7897002 18.6655609,67.1998307 C18.6650738,67.1990914 18.6643432,67.198352 18.6638561,67.1976127 C18.6636126,67.1973663 18.6636126,67.1971198 18.663369,67.1968734 C16.435903,64.2794811 14.5111639,61.3608567 12.9427317,58.5213405 C12.9420011,58.5198618 12.9410269,58.5186296 12.9402963,58.5171509 C11.1614409,55.3018091 9.68238984,52.1327986 8.54454586,49.0976066 C8.54405877,49.0963744 8.54357168,49.0953886 8.54308459,49.0944028 L8.54308459,49.0941564 C7.24352648,45.6338502 6.23792763,42.2659602 5.55380868,39.0838882 C5.55380868,39.0833953 5.55356514,39.0831489 5.55356514,39.0829024 C4.76813131,35.4392427 4.26569721,31.9306337 4.06038846,28.6551598 C4.06038846,28.6534347 4.05990137,28.651956 4.05990137,28.6504774 C3.8212269,24.8781744 3.85093944,21.282571 4.14830834,17.9637231 C4.15196152,17.9235529 4.15196152,17.8836292 4.1529357,17.8437054 C4.54553084,12.7115299 5.48439825,7.5670323 6.94810594,2.55019216 C7.24230875,1.54150096 6.67265612,0.482535391 5.67582491,0.184832247 C4.67948079,-0.11311734 3.63247924,0.463066394 3.33827643,1.47225048 C1.7842134,6.79911591 0.790791827,12.2649752 0.385775872,17.7180195 C0.383096873,17.7552323 0.383827509,17.7917059 0.383096873,17.8284259 C0.0854844274,21.2840497 0.0574767096,25.0048461 0.303701081,28.8944559 C0.303701081,28.8951953 0.303701081,28.8956881 0.303701081,28.8964275 C0.520943554,32.3601838 1.04919347,36.0568288 1.87408164,39.8843351 C1.87481228,39.8872924 1.87505583,39.8904961 1.87554292,39.8934534 C2.59911622,43.2598648 3.65853859,46.810862 5.02458459,50.4471285 L5.02458459,50.4471285 C5.02482813,50.4476214 5.02482813,50.4481142 5.02507168,50.4486071 C6.22891645,53.6592665 7.78711975,57.0002943 9.65657403,60.3787814 C9.65681758,60.3792742 9.65706112,60.3797671 9.65730467,60.38026 C9.6580353,60.3814922 9.65852239,60.382478 9.65925303,60.3834638 C9.65925303,60.3834638 9.65925303,60.3834638 9.65949658,60.3837102 L9.65949658,60.3837102 C11.3182841,63.3853859 13.3453122,66.4609946 15.6848091,69.5252668 C15.6857833,69.5264991 15.6867575,69.5272384 15.6874881,69.5284706 C17.7749155,72.265713 20.2393511,75.0170026 23.0126023,77.7054493 C23.0133329,77.7061887 23.01382,77.706928 23.0145506,77.7076673 C25.5048021,80.1255196 28.3793681,82.4975335 31.5586094,84.7581551 C31.5590965,84.7584015 31.55934,84.758648 31.5598271,84.7588944 L31.5598271,84.7588944 C34.4258691,86.7996889 37.6776869,88.731802 41.2244382,90.5017556 C41.4923381,90.6353277 41.7760684,90.6986636 42.055415,90.6986636 C42.7492757,90.6986636 43.4170771,90.3085443 43.7446457,89.6362478 C44.2042158,88.692864 43.8211189,87.5510936 42.8890708,87.0858092 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M110.673593,17.8284252 C110.672862,17.7917052 110.673593,17.7554781 110.670914,17.7185117 C110.265898,12.2644818 109.272476,6.79837633 107.718413,1.47249687 C107.42421,0.464052149 106.377939,-0.11114579 105.380621,0.185325128 C104.38379,0.48302826 103.814381,1.54224023 104.108583,2.55093139 C105.572048,7.56653913 106.510915,12.7107901 106.903754,17.8434583 C106.904971,17.8836285 106.904971,17.9237987 106.908625,17.9642153 C107.205994,21.2818309 107.235706,24.8776805 106.997032,28.651462 C106.997032,28.6522014 106.997032,28.6529407 106.997032,28.6534336 C106.997032,28.6541729 106.996788,28.6546658 106.996788,28.6554051 C106.791479,31.9294003 106.289045,35.4377627 105.503368,39.0831474 C105.503368,39.0833938 105.503124,39.0838867 105.503124,39.0841331 C104.819492,42.266205 103.81365,45.6340949 102.513848,49.0941545 C102.513605,49.0946474 102.513605,49.0948938 102.513361,49.0953867 C102.513118,49.0963725 102.512631,49.0971118 102.512144,49.0978512 C101.374543,52.1327966 99.895005,55.3027928 98.1146883,58.5205989 C98.1144447,58.5208453 98.1142012,58.5213382 98.1139576,58.5215847 C96.545769,61.3603615 94.6210299,64.2789858 92.3930768,67.1971172 C92.3925897,67.1978566 92.3921026,67.1985959 92.3916155,67.1993352 C92.391372,67.1995817 92.391372,67.1995817 92.3911284,67.1998281 C90.4171932,69.7887117 88.0767221,72.3995288 85.4357161,74.9600714 C85.435229,74.9605643 85.4347419,74.9613037 85.4342548,74.9617965 C83.0825806,77.2448444 80.3573079,79.4924045 77.3344227,81.6418802 C77.3336921,81.6423731 77.3329614,81.6431124 77.3319873,81.6438518 C77.3317437,81.6438518 77.3315002,81.6440982 77.3312566,81.6440982 C74.6232756,83.5722682 71.5402347,85.4030931 68.1673748,87.0858059 C67.2350831,87.5508438 66.8519862,88.6926142 67.3117999,89.6357515 C67.6393684,90.3085409 68.3069263,90.6984137 69.0010306,90.6984137 C69.2803772,90.6984137 69.5641075,90.6350778 69.8317639,90.5015057 C73.3780281,88.7320451 76.6293589,86.8001785 79.4954008,84.7596305 C79.496375,84.7588912 79.4973492,84.7586447 79.4983234,84.7579054 C82.6780518,82.4965445 85.5526178,80.1245307 88.0421387,77.7074179 C88.0428693,77.7066786 88.0433564,77.7059392 88.044087,77.7051999 C90.8185559,75.0150282 93.2837222,72.2632458 95.3706625,69.5262499 C95.3709061,69.5262499 95.3709061,69.5260035 95.3711496,69.5257571 C95.3713932,69.5255106 95.3716367,69.5252642 95.3718803,69.5250177 C97.7125949,66.458774 99.7408407,63.3819333 101.399385,60.3800113 C101.400602,60.3780397 101.401333,60.3760682 101.402307,60.3740966 C103.271274,56.9958561 104.828747,53.6563072 106.031131,50.4486052 C106.031131,50.4483587 106.031374,50.4483587 106.031374,50.4478659 C106.031374,50.4476194 106.031618,50.4476194 106.031618,50.4471265 C107.396933,46.8128318 108.455625,43.2640527 109.179198,39.8991201 C109.179442,39.8983808 109.179685,39.8978879 109.179929,39.8971486 C110.006278,36.063235 110.535502,32.3621541 110.752745,28.8961799 C110.752988,28.8934691 110.752745,28.8910046 110.752745,28.8885402 C110.998969,24.9996698 110.970962,21.2808451 110.673593,17.8284252 Z"
                                                id="Path"
                                              ></path>
                                            </g>
                                            <g
                                              id="Group"
                                              transform="translate(27.777778, 22.044444)"
                                              fill="#FFB125"
                                            >
                                              <path
                                                d="M23.678813,32.71647 C18.131877,32.71647 12.7253823,30.775304 8.42324493,27.1591074 C3.11585609,22.6977705 0.071714746,16.1919618 0.071714746,9.31007058 L0.071714746,2.88346299 C0.071714746,2.14064475 0.365047957,1.44210045 0.897430304,0.917454322 C1.42806958,0.394775926 2.13276652,0.10699535 2.88178714,0.10699535 C2.88427724,0.10699535 2.88676733,0.10699535 2.88925743,0.10699535 L19.9235004,0.143890296 C20.9860241,0.146103993 21.8456049,0.998869169 21.8433638,2.04865335 C21.8408737,3.09671578 20.9797988,3.94505356 19.9195163,3.94505356 C19.9180222,3.94505356 19.9165282,3.94505356 19.9150341,3.94505356 L3.91990782,3.91037231 L3.91965881,9.30982462 C3.91965881,15.0752748 6.47001428,20.5258881 10.9168262,24.263838 C15.3295239,27.9730099 21.1306986,29.5774481 26.8297794,28.6641752 C27.027493,28.6324455 27.2264516,28.5992401 27.4274022,28.5645588 C28.4752343,28.3852494 29.4712723,29.0749389 29.6545434,30.1087353 C29.8378144,31.1427776 29.1378486,32.1276267 28.0912616,32.3086579 C27.8743743,32.3460448 27.6589811,32.3822018 27.4455799,32.4163912 C26.190821,32.6175916 24.9308328,32.71647 23.678813,32.71647 Z"
                                                id="Path"
                                              ></path>
                                              <path
                                                d="M45.5458342,32.7164716 C44.2933164,32.7164716 43.0343242,32.6175932 41.7788182,32.4166387 C41.5654171,32.3824494 41.3500239,32.3462923 41.1331366,32.3089054 C40.0863005,32.1278742 39.3865838,31.1427791 39.5698548,30.1089827 C39.7531258,29.0749403 40.751405,28.3850048 41.7969959,28.5648062 C41.9976976,28.5997334 42.1969052,28.6329388 42.3946188,28.6644225 C48.0949447,29.5769576 53.8948744,27.9732572 58.3075721,24.2640851 C62.7543841,20.526381 65.3047396,15.0757674 65.3047396,9.31007103 L65.3047396,3.91061846 L49.3096131,3.94529971 C49.3081191,3.94529971 49.306625,3.94529971 49.305131,3.94529971 C48.2445994,3.94529971 47.3835245,3.09720785 47.3812834,2.04889941 C47.3787933,0.999115177 48.2383742,0.14634996 49.3011468,0.144136263 L66.336137,0.107241316 C66.3386271,0.107241316 66.3411172,0.107241316 66.3436073,0.107241316 C67.0921299,0.107241316 67.7965779,0.394775939 68.3274661,0.917700327 C68.8598485,1.44259244 69.1531817,2.14064485 69.1531817,2.88370909 L69.1531817,9.31031699 C69.1531817,16.1922085 66.1092893,22.6980176 60.8016514,27.1593546 C56.499514,30.7750595 51.0925213,32.7164716 45.5458342,32.7164716 Z"
                                                id="Path"
                                              ></path>
                                            </g>
                                            <path
                                              d="M50,82.6666667 L75,82.6666667 C64.6443721,69.1213524 65.724985,49.6 65.724985,49.6 L62.500123,49.6 L59.275261,49.6 C59.275261,49.6 60.355874,69.1216062 50,82.6666667 Z"
                                              id="Path"
                                              fill="#FED130"
                                            ></path>
                                            <path
                                              d="M65.4358416,49.6 L62.1105346,49.6 L58.7852276,49.6 C58.7852276,49.6 58.9577468,52.6309313 58.5140173,57.1325357 C57.668166,65.7131954 59.795987,74.3692288 64.8162948,81.3779562 C65.1278442,81.8129404 65.4505565,82.2428489 65.7846855,82.6666667 L75,82.6666667 C64.3215707,69.1215022 65.4358416,49.6 65.4358416,49.6 Z"
                                              id="Path"
                                              fill="#F7BC14"
                                            ></path>
                                            <path
                                              d="M44.4444444,16.5333333 L44.4444444,33.3377305 C44.4444444,43.2796237 48.9096297,52.6297198 56.4734722,58.5267517 L56.4734722,58.5267517 C60.0573988,61.3207124 64.9426012,61.3207124 68.5265278,58.5267517 L68.5265278,58.5267517 C76.0903703,52.6299691 80.5555556,43.2796237 80.5555556,33.3377305 L80.5555556,16.5333333 L44.4444444,16.5333333 L44.4444444,16.5333333 Z"
                                              id="Path"
                                              fill="#FED130"
                                            ></path>
                                            <path
                                              d="M72.0094117,16.5333333 L72.0094117,33.3378693 C72.0094117,43.2798446 67.5705407,52.630018 60.0512736,58.5270986 L60.0512736,58.5270986 C59.5058697,58.9548713 58.9300225,59.3163342 58.3333333,59.6129831 C61.6347948,61.2550219 65.5800156,60.8935589 68.5974175,58.5270986 L68.5974175,58.5270986 C76.1166846,52.6302672 80.5555556,43.2798446 80.5555556,33.3378693 L80.5555556,16.5333333 L72.0094117,16.5333333 L72.0094117,16.5333333 Z"
                                              id="Path"
                                              fill="#F7BC14"
                                            ></path>
                                            <path
                                              d="M82.255121,19.2888889 L42.744879,19.2888889 C42.1493729,19.2888889 41.6666667,18.6865363 41.6666667,17.9434247 L41.6666667,12.3676864 C41.6666667,11.6245748 42.1493729,11.0222222 42.744879,11.0222222 L82.255121,11.0222222 C82.8506271,11.0222222 83.3333333,11.6245748 83.3333333,12.3676864 L83.3333333,17.9434247 C83.3333333,18.6865363 82.8503865,19.2888889 82.255121,19.2888889 Z"
                                              id="Path"
                                              fill="#FFB125"
                                            ></path>
                                            <path
                                              d="M82.3098774,11.0222222 L75,11.0222222 L75,19.2888889 L82.3098774,19.2888889 C82.8752672,19.2888889 83.3333333,18.6865144 83.3333333,17.9433758 L83.3333333,12.3674352 C83.3333333,11.6245967 82.8750388,11.0222222 82.3098774,11.0222222 Z"
                                              id="Path"
                                              fill="#FF901D"
                                            ></path>
                                            <path
                                              d="M85.2218364,90.9333333 L42.5559414,90.9333333 C41.9374776,90.9333333 41.5082141,90.278095 41.7224773,89.6610157 L44.8909679,80.5289745 C45.0197224,80.1575769 45.35242,79.9111111 45.7244321,79.9111111 L82.0533457,79.9111111 C82.4253577,79.9111111 82.7580554,80.1575769 82.8868099,80.5289745 L86.0553005,89.6610157 C86.2695637,90.278095 85.8403002,90.9333333 85.2218364,90.9333333 Z"
                                              id="Path"
                                              fill="#FFB125"
                                            ></path>
                                            <path
                                              d="M83.2846897,89.6610157 L80.5176781,80.5289745 C80.4050235,80.1575769 80.1146964,79.9111111 79.7896074,79.9111111 L72.2222222,79.9111111 L75.5619484,90.9333333 L82.5566191,90.9333333 C83.0967174,90.9333333 83.471589,90.278095 83.2846897,89.6610157 Z"
                                              id="Path"
                                              fill="#FF901D"
                                            ></path>
                                          </g>
                                        </g>
                                      </g>
                                    </g>
                                  </g>
                                </g>
                              </g>
                            </g>
                          </g>
                        </g>
                      </svg>
                    )}

                    {localStorage.getItem("memberShip") == "false" && (
                      <svg
                        version="1.1"
                        id="icon-premium"
                        xmlns="http://www.w3.org/2000/svg"
                        x="0px"
                        y="0px"
                        height="5rem"
                        width="5rem"
                        viewBox="0 0 370.04 370.04"
                        fill="rgba(0,0,0,0.28)"
                      >
                        <g>
                          <g id="Layer_5_21_">
                            <g>
                              <path d="M341.668,314.412c0,0-41.071-70.588-48.438-83.248c8.382-2.557,17.311-4.815,21.021-11.221 c6.183-10.674-4.823-28.184-1.933-39.625c2.977-11.775,20.551-21.964,20.551-33.933c0-11.661-18.169-25.284-21.148-36.99 c-2.91-11.439,8.063-28.968,1.86-39.629c-6.203-10.662-26.864-9.786-35.369-17.97c-8.751-8.422-8.724-29.028-19.279-34.672 c-10.598-5.665-27.822,5.784-39.589,3.072C207.711,17.515,197.318,0,185.167,0c-12.331,0-31.944,19.868-35.02,20.583 c-11.761,2.734-29.007-8.687-39.594-2.998c-10.545,5.663-10.48,26.271-19.215,34.707c-8.491,8.199-29.153,7.361-35.337,18.035 c-6.183,10.672,4.823,28.178,1.934,39.625c-2.897,11.476-21.083,23.104-21.083,36.376c0,11.97,17.618,22.127,20.613,33.896 c2.911,11.439-8.062,28.966-1.859,39.631c3.377,5.805,11.039,8.188,18.691,10.479c0.893,0.267,2.582,1.266,1.438,2.933 c-5.235,9.036-47.37,81.755-47.37,81.755c-3.352,5.784-0.63,10.742,6.047,11.023l32.683,1.363 c6.677,0.281,15.053,5.133,18.617,10.786l17.44,27.674c3.564,5.653,9.219,5.547,12.57-0.236c0,0,48.797-84.246,48.817-84.27 c0.979-1.144,1.963-0.909,2.434-0.509c5.339,4.546,12.782,9.081,18.994,9.081c6.092,0,11.733-4.269,17.313-9.03 c0.454-0.387,1.559-1.18,2.367,0.466c0.013,0.026,48.756,83.811,48.756,83.811c3.36,5.776,9.016,5.874,12.569,0.214 l17.391-27.707c3.554-5.657,11.921-10.528,18.598-10.819l32.68-1.424C342.315,325.152,345.028,320.187,341.668,314.412z M239.18,238.631c-36.136,21.023-79.511,18.77-112.641-2.127c-48.545-31.095-64.518-95.419-35.335-145.788 c29.516-50.95,94.399-68.928,145.808-40.929c0.27,0.147,0.537,0.299,0.805,0.449c0.381,0.211,0.761,0.425,1.14,0.641 c15.86,9.144,29.613,22.415,39.461,39.342C308.516,141.955,290.915,208.533,239.18,238.631z"></path>
                              <path d="M230.916,66.103c-0.15-0.087-0.302-0.168-0.452-0.254C203.002,49.955,168,48.793,138.665,65.86 c-43.532,25.326-58.345,81.345-33.019,124.876c7.728,13.284,18.318,23.888,30.536,31.498c1.039,0.658,2.09,1.305,3.164,1.927 c43.579,25.247,99.568,10.333,124.814-33.244C289.405,147.338,274.495,91.35,230.916,66.103z M241.818,137.344l-15.259,14.873 c-4.726,4.606-7.68,13.698-6.563,20.203l3.602,21.001c1.116,6.505-2.75,9.314-8.592,6.243l-18.861-9.916 c-5.842-3.071-15.401-3.071-21.243,0l-18.86,9.916c-5.842,3.071-9.709,0.262-8.593-6.243l3.602-21.001 c1.116-6.505-1.838-15.597-6.564-20.203l-15.258-14.873c-4.727-4.606-3.249-9.152,3.282-10.102l21.086-3.064 c6.531-0.949,14.265-6.568,17.186-12.486l9.43-19.107c2.921-5.918,7.701-5.918,10.621,0l9.431,19.107 c2.921,5.918,10.654,11.537,17.186,12.486l21.086,3.064C245.067,128.192,246.544,132.738,241.818,137.344z"></path>
                            </g>
                          </g>
                        </g>
                        <g></g>
                        <g></g>
                        <g></g>
                        <g></g>
                        <g></g>
                        <g></g>
                        <g></g>
                        <g></g>
                        <g></g>
                        <g></g>
                        <g></g>
                        <g></g>
                        <g></g>
                        <g></g>
                        <g></g>
                      </svg>
                    )}

                    <Typography variant="h6" fontWeight={1000} color="#333333">
                      {localStorage.getItem("name")}
                    </Typography>
                  </Item>
                  {localStorage.getItem("memberShip") == "true" && (
                    <>
                      <Item>
                        <Typography variant="p" color={"#333333"}>
                          Chào mừng đến với 4AE Movie
                        </Typography>
                      </Item>
                      <Item>
                        <LinkRouter to="/pay/1">
                          <MyButton variant="contained" size="medium">
                            Nâng cấp gói
                          </MyButton>
                        </LinkRouter>
                      </Item>
                    </>
                  )}

                  {localStorage.getItem("memberShip") == "false" && (
                    <>
                      <Item>
                        <Typography variant="p" color={"#333333"}>
                          Bạn chưa có gói 4AE Movie
                        </Typography>
                      </Item>
                      <Item>
                        <LinkRouter to="/pay/1">
                          <MyButton variant="contained" size="medium">
                            Đăng ký gói
                          </MyButton>
                        </LinkRouter>
                      </Item>
                    </>
                  )}
                </Stack>
              </StyledPaper>
            </Grid>
            <Grid item display={{ xs: "none", md: "block" }} md={7}>
              <Item3>
                <Stack>
                  <Item2 sx={{ paddingTop: 2, paddingBottom: 2 }}>
                    <Grid container>
                      <Grid item xs={2}>
                        <PersonIcon sx={{ color: "#333333", height: "100%" }} />
                      </Grid>
                      <Grid
                        item
                        xs={10}
                        textAlign={"left"}
                        alignSelf={"center"}
                      >
                        <Typography variant="p" color={"#333333"}>
                          Tài khoản
                        </Typography>
                      </Grid>
                    </Grid>
                  </Item2>

                  <Item2 sx={{ paddingTop: 2, paddingBottom: 2 }}>
                    <Grid container>
                      <Grid item xs={2}>
                        <LogoutIcon sx={{ color: "#333333", height: "100%" }} />
                      </Grid>
                      <Grid
                        item
                        xs={10}
                        textAlign={"left"}
                        alignSelf={"center"}
                      >
                        <Typography onClick={handleLogout} variant="p" color={"#333333"}>
                          Đăng xuất
                        </Typography>
                      </Grid>
                    </Grid>
                  </Item2>
                </Stack>
              </Item3>
            </Grid>
          </Grid>
        </Grid>

        <Grid item xs={12} md={9} sx={{ height: "100%", width: "100%" }}>
          <Grid xs={12} sx={{ marginLeft: 3 }}>
            <StyledPaper>
              <Stack>
                <form onSubmit={formik.handleSubmit}>
                  <ItemRight sx={{ paddingTop: 2 }}>
                    <Grid container>
                      <Grid xs={9}>
                        <Typography variant="h6" color="#333333">
                          Thông tin tài khoản
                        </Typography>
                      </Grid>
                      <Grid xs={3} textAlign={"right"}>
                        <Link
                          href="#"
                          onClick={handleChangeAccount}
                          underline="none"
                        >
                          <TypographyLink variant="h6">
                            Chỉnh sửa
                          </TypographyLink>
                        </Link>
                      </Grid>
                    </Grid>
                  </ItemRight>
                  <ItemRight>
                    <Grid container alignItems={"center"}>
                      <Grid xs={12} md={2} paddingBottom={{ xs: 2, md: 0 }}>
                        <Typography variant="p">Họ và tên</Typography>
                      </Grid>
                      <Grid xs={12} md={6}>
                        <TextField
                          hiddenLabel
                          variant="outlined"
                          width={200}
                          id="fullName"
                          name="fullName"
                          value={formik.values.fullName}
                          onChange={formik.handleChange}
                          onBlur={formik.handleBlur}
                          size="small"
                          sx={{ width: "100%" }}
                          InputProps={{
                            readOnly: !updateAccount,
                          }}
                        />
                        {formik.errors.fullName && formik.touched && (
                          <FormHelperText error>
                            {formik.errors.fullName}
                          </FormHelperText>
                        )}
                      </Grid>
                    </Grid>
                  </ItemRight>
                  <ItemRight>
                    <Grid container alignItems={"center"}>
                      <Grid xs={12} md={2} paddingBottom={{ xs: 2, md: 0 }}>
                        <Typography variant="p">Email</Typography>
                      </Grid>
                      <Grid xs={12} md={6}>
                        <TextField
                          hiddenLabel
                          variant="outlined"
                          id="email"
                          name="email"
                          value={formik.values.email}
                          size="small"
                          sx={{ width: "100%" }}
                          InputProps={{
                            readOnly: true,
                            endAdornment: <CheckCircleIcon color="success" />,
                          }}
                        />
                      </Grid>
                    </Grid>
                  </ItemRight>
                  <ItemRight>
                    <Grid container alignItems={"center"}>
                      <Grid xs={12} md={2} paddingBottom={{ xs: 2, md: 0 }}>
                        <Typography variant="p">Giới tính</Typography>
                      </Grid>
                      <Grid xs={12} md={6}>
                        <RadioGroup
                          row
                          id="gender"
                          aria-labelledby="demo-row-radio-buttons-group-label"
                          name="gender"
                          onChange={(e) => handleChangeGender(e)}
                          defaultValue={formik.values.gender}
                          onBlur={formik.handleBlur}
                        >
                          <CustomFormControlLabel
                            value="female"
                            control={<Radio />}
                            label="Nữ"
                            sx={{
                              pointerEvents: updateAccount ? "auto" : "none",
                            }}
                          />
                          <CustomFormControlLabel
                            value="male"
                            control={<Radio />}
                            label="Nam"
                            sx={{
                              pointerEvents: updateAccount ? "auto" : "none",
                            }}
                          />
                          <CustomFormControlLabel
                            value="other"
                            control={<Radio />}
                            label="Khác"
                            sx={{
                              pointerEvents: updateAccount ? "auto" : "none",
                            }}
                          />
                        </RadioGroup>
                      </Grid>
                    </Grid>
                  </ItemRight>
                  <ItemRight>
                    <Grid container alignItems={"center"}>
                      <Grid xs={12} md={2} paddingBottom={{ xs: 2, md: 0 }}>
                        <Typography variant="p">Số điện thoại</Typography>
                      </Grid>
                      <Grid xs={12} md={6}>
                        <TextField
                          hiddenLabel
                          variant="outlined"
                          id="phone"
                          name="phone"
                          value={formik.values.phone}
                          onChange={formik.handleChange}
                          onBlur={formik.handleBlur}
                          size="small"
                          sx={{ width: "100%" }}
                          InputProps={{
                            readOnly: !updateAccount,
                          }}
                        />
                        {formik.errors.phone && formik.touched && (
                          <FormHelperText error>
                            {formik.errors.phone}
                          </FormHelperText>
                        )}
                      </Grid>
                    </Grid>
                  </ItemRight>

                  {updateAccount && (
                    <ItemRight>
                      <Grid container alignItems={"center"}>
                        <Grid xs={2}></Grid>
                        <Grid xs={4}>
                          <Box
                            sx={{
                              display: "flex",
                              justifyContent: "space-around",
                            }}
                          >
                            <MyButton2
                              type="submit"
                              variant="contained"
                              size="medium"
                            >
                              Lưu
                            </MyButton2>
                            <MyButton3
                              onClick={handleChangeAccount}
                              variant="outlined"
                              size="medium"
                            >
                              Hủy
                            </MyButton3>
                          </Box>
                        </Grid>
                      </Grid>
                    </ItemRight>
                  )}
                </form>
                <ItemRight>
                  <Grid container alignItems={"center"}>
                    <Grid xs={12} md={2} paddingBottom={{ xs: 2, md: 0 }}>
                      <Typography variant="p">Mật khẩu</Typography>
                    </Grid>
                    <Grid xs={12} md={6}>
                      <TextField
                        hiddenLabel
                        type="password"
                        variant="outlined"
                        fontFamily="'Manrope, sans-serif'"
                        id="filled-hidden-label-small"
                        value={password == "null" ? "" : password}
                        size="small"
                        sx={{ width: "100%", color: "#333333" }}
                        InputProps={{
                          readOnly: true,
                        }}
                      />
                    </Grid>
                    <Grid
                      xs={4}
                      textAlign={{ xs: "left", md: "right" }}
                      paddingTop={{ xs: 2, md: 0 }}
                      onClick={() => setFlag(!flag)}
                    >
                      <BasicModal />
                    </Grid>
                  </Grid>
                </ItemRight>
              </Stack>
            </StyledPaper>
          </Grid>
          <Grid xs={12} sx={{ marginLeft: 3 }}>
            <StyledPaperRight>
              <Stack>
                <ItemRight sx={{ paddingTop: 2 }}>
                  <Typography variant="h6" color="#333333">
                    Tài khoản
                  </Typography>
                </ItemRight>
                <ItemRight>
                  <BasicTabs />
                </ItemRight>
              </Stack>
            </StyledPaperRight>
          </Grid>
        </Grid>
      </Grid>
      <Dialog
        open={isFinish}
        onClose={handleCloseFinish}
        aria-labelledby="alert-dialog-title"
        aria-describedby="alert-dialog-description"
      >
        <DialogTitle id="alert-dialog-title">{"Congraturation"}</DialogTitle>
        <DialogContent>
          <DialogContentText id="alert-dialog-description">
            <Alert severity="success">
              <AlertTitle>Cập nhật thông tin thành công</AlertTitle>
            </Alert>
          </DialogContentText>
        </DialogContent>
        <DialogActions>
          <Button autoFocus onClick={handleCloseFinish}>
            Close
          </Button>
        </DialogActions>
      </Dialog>
    </Box>
  );
}

const Item = styled(Paper)(({ theme }) => ({
  boxShadow: "none",
  borderRadius: 0,
  backgroundColor: "rgb(245, 245, 245)",
  ...theme.typography.body2,
  padding: theme.spacing(1),
  textAlign: "center",
  color: theme.palette.text.secondary,
}));

const Item2 = styled(Paper)(({ theme }) => ({
  boxShadow: "none",
  borderRadius: 0,
  backgroundColor: "rgb(245, 245, 245)",
  ...theme.typography.body2,
  padding: theme.spacing(1),
  textAlign: "center",
  color: theme.palette.text.secondary,
  "&:hover": {
    backgroundColor: "rgba(0,119,200,0.2)",
    color: "black",
    cursor: "pointer",
  },
}));

const Item3 = styled(Paper)(({ theme }) => ({
  boxShadow: "none",
  borderRadius: 0,
  backgroundColor: "rgb(245, 245, 245)",
  ...theme.typography.body2,
  textAlign: "center",
  color: theme.palette.text.secondary,
  "&:hover": {
    backgroundColor: "rgba(0,119,200,0.2)",
    color: "black",
    cursor: "pointer",
  },
}));

const StyledPaper = styled(Paper)(({ theme }) => ({
  marginBottom: 1,
  borderRadius: 0,
  backgroundColor: "rgb(245, 245, 245)",
  ...theme.typography.body2,
  color: theme.palette.text.primary,
}));

const StyledPaperRight = styled(Paper)(({ theme }) => ({
  marginBottom: 1,
  borderRadius: 0,
  backgroundColor: "background.default",
  ...theme.typography.body2,
  color: theme.palette.text.primary,
}));

const ItemRight = styled(Paper)(({ theme }) => ({
  boxShadow: "none",
  borderRadius: 0,
  backgroundColor: "background.default",
  ...theme.typography.body2,
  padding: theme.spacing(1),
  textAlign: "left",
  color: theme.palette.text.secondary,
}));

const CustomFormControlLabel = styled(FormControlLabel)({
  fontFamily: "Manrope, sans-serif",
  fontSize: "16px",
  color: "#333333",
});

const TypographyLink = styled(Typography)({
  fontFamily: "Manrope, sans-serif",
  fontSize: "16px",
  color: "#0a75ff",
  fontWeight: "bold",
  "&:hover": {
    color: "#12A7FF",
    transition: "color 0.5s",
  },
});

const MyButton = styled(Button)({
  "&:hover": {
    backgroundColor: "#12A7FF",
  },
});

const MyButton2 = styled(Button)({
  borderRadius: "10rem",
  width: "8rem",
  "&:hover": {
    backgroundColor: "#12A7FF",
  },
});

const MyButton3 = styled(Button)({
  borderRadius: "10rem",
  width: "8rem",
});
